#!/usr/bin/env python3
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç–æ–≤ –∏ —É–ª—É—á—à–µ–Ω–∏–π –≤ Telegram
"""

import os
import json
from datetime import datetime
from telegram_sender import send_bug_reports_to_telegram, send_improvements_to_telegram

def create_test_bugreport(timestamp: str):
    """–°–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–π –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏"""
    test_bug_content = """# –ó–∞–≥–æ–ª–æ–≤–æ–∫
–ü—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –¥–∞–Ω–Ω—ã—Ö –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

## –û–ø–∏—Å–∞–Ω–∏–µ
–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∞–µ—Ç –∏ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

## –®–∞–≥–∏ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
1. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ù–∞–∂–∞—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É "–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"
3. –ü–æ–¥–æ–∂–¥–∞—Ç—å 30 —Å–µ–∫—É–Ω–¥

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 5-10 —Å–µ–∫—É–Ω–¥

## –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∞–µ—Ç, –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –∫—Ä—É—Ç–∏—Ç—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ

## –û–∫—Ä—É–∂–µ–Ω–∏–µ
- iOS 17.2
- –í–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: 2.1.0
- –ú–æ–¥–µ–ª—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞: iPhone 14 Pro

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç
–í—ã—Å–æ–∫–∏–π - –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å"""

    filename = f"output/bugreport_1_{timestamp}.md"
    with open(filename, 'w', encoding='utf-8') as f:
        f.write(test_bug_content)
    
    print(f"‚úÖ –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç: {filename}")
    return filename

def create_test_improvement(timestamp: str):
    """–°–æ–∑–¥–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏"""
    test_improvement_content = """# –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

## –ö–∞—Ç–µ–≥–æ—Ä–∏—è
UX Improvement, Feature

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
–ú–Ω–æ–≥–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∂–∞–ª—É—é—Ç—Å—è –Ω–∞ —Å–ª–∏—à–∫–æ–º —è—Ä–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –≤ —Ç–µ–º–Ω–æ–µ –≤—Ä–µ–º—è —Å—É—Ç–æ–∫. –≠—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç —É—Å—Ç–∞–ª–æ—Å—Ç—å –≥–ª–∞–∑ –∏ –Ω–µ—É–¥–æ–±—Å—Ç–≤–æ.

## –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ
–î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É —Å–≤–µ—Ç–ª–æ–π –∏ —Ç–µ–º–Ω–æ–π —Ç–µ–º–∞–º–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.

## –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —ç—Ñ—Ñ–µ–∫—Ç (User Impact)
- –£–ª—É—á—à–µ–Ω–∏–µ –∫–æ–º—Ñ–æ—Ä—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ —Ç–µ–º–Ω–æ–µ –≤—Ä–µ–º—è
- –≠–∫–æ–Ω–æ–º–∏—è –∑–∞—Ä—è–¥–∞ –±–∞—Ç–∞—Ä–µ–∏ –Ω–∞ OLED-—ç–∫—Ä–∞–Ω–∞—Ö
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º UX

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –≤–µ—á–µ—Ä–Ω–µ–µ –≤—Ä–µ–º—è –Ω–∞ 25-30%, —Å–Ω–∏–∂–µ–Ω–∏–µ –∂–∞–ª–æ–± –Ω–∞ —É—Å—Ç–∞–ª–æ—Å—Ç—å –≥–ª–∞–∑.

## –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç
Medium - —É–ª—É—á—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞

## –û—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è
Medium - —Ç—Ä–µ–±—É–µ—Ç –∞–¥–∞–ø—Ç–∞—Ü–∏–∏ –≤—Å–µ—Ö —ç–∫—Ä–∞–Ω–æ–≤ –ø–æ–¥ —Ç–µ–º–Ω—É—é —Ç–µ–º—É"""

    filename = f"output/improvement_proposal_dark_theme_{timestamp}.md"
    with open(filename, 'w', encoding='utf-8') as f:
        f.write(test_improvement_content)
    
    print(f"‚úÖ –°–æ–∑–¥–∞–Ω–æ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é: {filename}")
    return filename

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
    print("üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Telegram")
    print("=" * 50)
    
    # –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é –º–µ—Ç–∫—É –¥–ª—è —Ç–µ—Å—Ç–æ–≤
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    print(f"üìÖ Timestamp –¥–ª—è —Ç–µ—Å—Ç–æ–≤: {timestamp}")
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ output
    os.makedirs('output', exist_ok=True)
    
    print("\nüêõ –¢–ï–°–¢ 1: –°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç–∞")
    print("-" * 40)
    
    try:
        # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç
        bug_file = create_test_bugreport(timestamp)
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram
        print("üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç–∞...")
        success = send_bug_reports_to_telegram(timestamp, "@mmalashkin")
        
        if success:
            print("‚úÖ –¢–µ—Å—Ç –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç–∞ –ø—Ä–æ–π–¥–µ–Ω!")
        else:
            print("‚ùå –¢–µ—Å—Ç –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç–∞ –Ω–µ –ø—Ä–æ–π–¥–µ–Ω")
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –≤ —Ç–µ—Å—Ç–µ –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç–∞: {str(e)}")
    
    print("\nüí° –¢–ï–°–¢ 2: –°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é")
    print("-" * 55)
    
    try:
        # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
        improvement_file = create_test_improvement(timestamp)
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram
        print("üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è...")
        success = send_improvements_to_telegram(timestamp, "@mmalashkin")
        
        if success:
            print("‚úÖ –¢–µ—Å—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –ø—Ä–æ–π–¥–µ–Ω!")
        else:
            print("‚ùå –¢–µ—Å—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –Ω–µ –ø—Ä–æ–π–¥–µ–Ω")
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –≤ —Ç–µ—Å—Ç–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è: {str(e)}")
    
    print("\n" + "=" * 50)
    print("üéØ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!")
    print(f"üìÅ –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ output/ —Å timestamp {timestamp}")

if __name__ == "__main__":
    main() 