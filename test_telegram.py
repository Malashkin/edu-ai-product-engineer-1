#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Telegram
"""

import os
from telegram_notifier import TelegramNotifier, test_telegram_connection

def test_basic_message():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É –ø—Ä–æ—Å—Ç–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è"""
    print("\nüß™ –¢–µ—Å—Ç 1: –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–æ—Å—Ç–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è...")
    try:
        notifier = TelegramNotifier()
        response = notifier.send_message("üß™ –¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ –æ—Ç–∑—ã–≤–æ–≤")
        if response and response.get('ok'):
            print("‚úÖ –ü—Ä–æ—Å—Ç–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ")
        else:
            print("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–æ—Å—Ç–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è")
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –≤ —Ç–µ—Å—Ç–µ –ø—Ä–æ—Å—Ç–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è: {str(e)}")

def test_bug_report():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç–∞"""
    print("\nüêõ –¢–µ—Å—Ç 2: –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç–∞...")
    
    sample_bug_report = """# 1. –ó–∞–≥–æ–ª–æ–≤–æ–∫
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫—Ä–∞—à–∏—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

# 2. –û–ø–∏—Å–∞–Ω–∏–µ
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞, –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—è –æ—Å–Ω–æ–≤–Ω–æ–π —ç–∫—Ä–∞–Ω

# 3. –®–∞–≥–∏ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
1. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ü–æ–¥–æ–∂–¥–∞—Ç—å 2-3 —Å–µ–∫—É–Ω–¥—ã
3. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è

# 4. –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å—Å—è –∏ –ø–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω

# 5. –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –±–µ–∑ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ

# 6. –û–∫—Ä—É–∂–µ–Ω–∏–µ
- –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: iPhone 14
- iOS: 17.2.1
- –í–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: 2.1.0

# 7. –í–ª–æ–∂–µ–Ω–∏—è
–õ–æ–≥–∏ crash report –ø—Ä–∏–ª–æ–∂–µ–Ω—ã

# 8. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ—è–≤–∏–ª–∞—Å—å –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏"""

    try:
        notifier = TelegramNotifier()
        response = notifier.send_bug_report(sample_bug_report, bug_index=1)
        if response and response.get('ok'):
            print("‚úÖ –ë–∞–≥-—Ä–µ–ø–æ—Ä—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ")
        else:
            print("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç–∞")
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –≤ —Ç–µ—Å—Ç–µ –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç–∞: {str(e)}")

def test_summary_report():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É —Ä–µ–∑—é–º–µ –¥–∏—Å–∫—É—Å—Å–∏–∏"""
    print("\nüìä –¢–µ—Å—Ç 3: –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—é–º–µ –¥–∏—Å–∫—É—Å—Å–∏–∏...")
    
    sample_summary = """# –†–µ–∑—é–º–µ –¥–∏—Å–∫—É—Å—Å–∏–∏ –æ –±–∞–≥–∞—Ö

## –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. **–ö—Ä–∞—à—ã –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ** - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞, –∑–∞—Ç—Ä–∞–≥–∏–≤–∞–µ—Ç 30% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. **–ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** - –≤–ª–∏—è–µ—Ç –Ω–∞ UX, –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 10 —Å–µ–∫—É–Ω–¥
3. **–ü—Ä–æ–±–ª–µ–º—ã —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π** - –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º:
- **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∫—Ä–∞—à—ã –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏
- **–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: –£–ª—É—á—à–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö

## –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
–ü—Ä–æ–±–ª–µ–º—ã —Å–µ—Ä—å–µ–∑–Ω–æ –≤–ª–∏—è—é—Ç –Ω–∞ retention rate –∏ –æ–±—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç"""

    try:
        notifier = TelegramNotifier()
        response = notifier.send_summary_report(sample_summary, "bugs")
        if response and response.get('ok'):
            print("‚úÖ –†–µ–∑—é–º–µ –¥–∏—Å–∫—É—Å—Å–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ")
        else:
            print("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–∑—é–º–µ")
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –≤ —Ç–µ—Å—Ç–µ —Ä–µ–∑—é–º–µ: {str(e)}")

def test_feature_summary():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É —Ä–µ–∑—é–º–µ –æ —Ñ—É–Ω–∫—Ü–∏—è—Ö"""
    print("\n‚ú® –¢–µ—Å—Ç 4: –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—é–º–µ –æ –∑–∞–ø—Ä–æ—Å–∞—Ö —Ñ—É–Ω–∫—Ü–∏–π...")
    
    sample_feature_summary = """# –†–µ–∑—é–º–µ –¥–∏—Å–∫—É—Å—Å–∏–∏ –æ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏—è—Ö

## –¢–æ–ø –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π:
1. **–¢–µ–º–Ω–∞—è —Ç–µ–º–∞** - –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç 45% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –≤–∞–∂–Ω–æ –¥–ª—è –º–æ—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –≥—Ä–∞—Ñ–∏–∫–∏** - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

## –ê–Ω–∞–ª–∏–∑ –æ—Å—É—â–µ—Å—Ç–≤–∏–º–æ—Å—Ç–∏:
- **–¢–µ–º–Ω–∞—è —Ç–µ–º–∞**: –õ–µ–≥–∫–æ —Ä–µ–∞–ª–∏–∑—É–µ–º–æ, –≤—ã—Å–æ–∫–∏–π impact
- **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è**: –°—Ä–µ–¥–Ω—è—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å, —Ç—Ä–µ–±—É–µ—Ç —Ä–∞–±–æ—Ç—ã —Å push notifications
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –í—ã—Å–æ–∫–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å, –Ω—É–∂–Ω–∞ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
–ù–∞—á–∞—Ç—å —Å —Ç–µ–º–Ω–æ–π —Ç–µ–º—ã –∫–∞–∫ quick win, –∑–∞—Ç–µ–º –∑–∞–Ω—è—Ç—å—Å—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è–º–∏"""

    try:
        notifier = TelegramNotifier()
        response = notifier.send_summary_report(sample_feature_summary, "features")
        if response and response.get('ok'):
            print("‚úÖ –†–µ–∑—é–º–µ –æ —Ñ—É–Ω–∫—Ü–∏—è—Ö –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ")
        else:
            print("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–∑—é–º–µ –æ —Ñ—É–Ω–∫—Ü–∏—è—Ö")
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –≤ —Ç–µ—Å—Ç–µ —Ä–µ–∑—é–º–µ –æ —Ñ—É–Ω–∫—Ü–∏—è—Ö: {str(e)}")

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è"""
    print("üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Telegram")
    print("=" * 50)
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
    bot_token = os.getenv("TELEGRAM_BOT_TOKEN")
    chat_id = os.getenv("TELEGRAM_CHAT_ID")
    
    if not bot_token:
        print("‚ùå TELEGRAM_BOT_TOKEN –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è")
        print("–î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª .env:")
        print("TELEGRAM_BOT_TOKEN=your_bot_token_here")
        return
    
    if not chat_id:
        print("‚ùå TELEGRAM_CHAT_ID –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è")
        print("–î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª .env:")
        print("TELEGRAM_CHAT_ID=your_chat_id_here")
        return
    
    print(f"‚úÖ –ù–∞–π–¥–µ–Ω —Ç–æ–∫–µ–Ω –±–æ—Ç–∞: {bot_token[:10]}...")
    print(f"‚úÖ –ù–∞–π–¥–µ–Ω Chat ID: {chat_id}")
    
    # –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
    if test_telegram_connection():
        test_basic_message()
        test_bug_report()
        test_summary_report()
        test_feature_summary()
        
        print("\n" + "=" * 50)
        print("üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã!")
        print("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞—à Telegram —á–∞—Ç –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π")
    else:
        print("\n‚ùå –ë–∞–∑–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.")

if __name__ == "__main__":
    main() 