import json
from examples.group_discussion import run_group_discussion
import os

def create_test_personas():
    """Создает тестовый файл с персонами, если его еще нет"""
    if os.path.exists("personas_test.json"):
        print("Файл personas_test.json уже существует")
        return
    
    personas = {
        "timestamp": "2025-04-24 21:55:10",
        "total_personas": 3,
        "personas": [
            {
                "site": "www.parfum-lider.ru",
                "part": 1,
                "based_on_reviews": 40,
                "based_on_summaries": 1,
                "persona": "Имя: Елена\nВозраст: 32\nПол: Женский\nПрофессия: Офисный работник (менеджер)\nОбраз жизни и ценности: Активная, следит за собой, ценит качество, практичность и удобство в использовании косметики. Предпочитает проверенные бренды. Внешний вид важен для работы и личной жизни.\nОсновные потребности:\n- Тушь, которая не осыпается в течение дня и выдерживает долгие рабочие часы\n- Эффект объемных и длинных ресниц для выразительного взгляда\n- Удобный аппликатор для быстрого нанесения утром\nБоли/тревоги: Беспокоится о склеивании и комковании ресниц, разочарована тушью, которая быстро высыхает или создает эффект 'паучьих лапок'."
            },
            {
                "site": "www.podrygka.ru",
                "part": 1,
                "based_on_reviews": 39,
                "based_on_summaries": 1,
                "persona": "Имя: Анна\nВозраст: 28\nПол: Женский\nПрофессия: Учитель начальных классов\nОбраз жизни и ценности: Ведет активный образ жизни, ценит время с семьей и друзьями. Придерживается практичности и экономии, но готова потратиться на качественную косметику. Заботится о своем внешнем виде, так как работает с людьми.\nОсновные потребности:\n- Тушь с водостойким эффектом, которая не размазывается в течение рабочего дня\n- Быстрое и равномерное нанесение без комков и склеивания ресниц\n- Насыщенный черный цвет для выразительного взгляда\nБоли/тревоги: Переживает из-за аллергических реакций, разочарована тушью, которая осыпается или оставляет следы под глазами к концу дня, недовольна тушью, которая трудно смывается."
            },
            {
                "site": "rivegauche.ru",
                "part": 1,
                "based_on_reviews": 19,
                "based_on_summaries": 1,
                "persona": "Имя: Мария\nВозраст: 35\nПол: Женский\nПрофессия: Маркетолог в крупной компании\nОбраз жизни и ценности: Современная городская женщина, следящая за модными тенденциями. Ценит качество, престиж брендов и эффективность косметических средств. Активно пользуется соцсетями, где важно хорошо выглядеть на фото.\nОсновные потребности:\n- Тушь премиального качества, придающая максимальный объем и удлинение ресниц\n- Стойкий эффект без осыпания на протяжении длительного времени (12+ часов)\n- Быстрое и равномерное нанесение для создания выразительного взгляда\nБоли/тревоги: Беспокоится о том, что тушь может скатываться или осыпаться во время важных мероприятий, разочарована тушью, которая оставляет следы под глазами или теряет эффект в течение дня."
            }
        ]
    }
    
    with open("personas_test.json", "w", encoding="utf-8") as f:
        json.dump(personas, f, ensure_ascii=False, indent=2)
    
    print("Создан тестовый файл personas_test.json")

if __name__ == "__main__":
    # Создаем тестовые персоны
    create_test_personas()
    
    # Запускаем групповую дискуссию
    print("\nЗапускаем тестовую групповую дискуссию...")
    results = run_group_discussion()
    
    print("\nРезультаты групповой дискуссии:")
    discussion_file = [f for f in os.listdir() if f.startswith("mascara_discussion_")]
    if discussion_file:
        latest_file = max(discussion_file, key=os.path.getctime)
        print(f"Сохранены в файл: {latest_file}")
    else:
        print("Файл с результатами не найден") 